#!/usr/bin/python
"""sitecustomize.py:

   TO DO: Might make a more gneral osenv 'PATH' setter for more than one path. Especially
          if more dlls are used from other modules.

"""
__author__ = "Michael Fisher"
__date__   = "2012.07.19  12:38:55"


#===============================< IMPORTS >=====================================

#from pymel.all import *
import os
import re
import platform
import sys
import traceback
import posixpath as ppath

import os
osenv = os.environ # Easier to read.

import inspect

#=================================< BODY >======================================


THIS_F_PTH = inspect.getfile(inspect.currentframe())
THIS_F_NAM = os.path.basename(THIS_F_PTH)
THIS_D_PTH = os.path.dirname(THIS_F_PTH)

MAYA_BIN_PTHS    = [r'C:\Program Files\Autodesk\Maya2016\bin', ]
MAYA_APP_D_BRNCH = osenv.get( 'MFROOT', osenv['USERPROFILE'] )
MAYA_APP_D_NAM   = 'MAYA' if 'MFROOT' in osenv else 'maya'

#--------------------< setup_env >-------------------------

def setup_env():
    """ setup_env - Set up OS env vars for proper launch of Maya through Python.
                    Can also be used to set env for anything else.

    """
    # print("\nBeginning env setup...\n")

    osenv['MAYA_LOCATION'] = 'C:\Program Files\Autodesk\Maya2016'
    osenv['MAYA_APP_DIR']  =  os.path.join( MAYA_APP_D_BRNCH, MAYA_APP_D_NAM)

    #---------------< set the PATH osenv >-------------------------------
    # print "Running Prologue Python sitecustomize.py script."

    # rel_bin_dirs = [ '' 'bin', 'pywin32_system32', 'PyQt4/bin', 'maya', 'maya/api']
    rel_bin_dirs = [ '' 'bin', 'PyQt4/bin', ]
    abs_bin_pths = [ppath.join(THIS_D_PTH, path) for path in rel_bin_dirs]


    # pywin_bin_path = ppath.join( THIS_D_PTH, 'pywin32_system32')
    # py_bin_path = ppath.join( THIS_D_PTH, 'bin')
    cur_env_paths = []
    if platform.system() == 'Windows':
        cur_env_paths =  [path for path in re.split(';',osenv['PATH'],) ]
    else:
        cur_env_paths =  [path for path in re.split(':',osenv['PATH'],) ]

    # print("\tAppending to system $PATH:\n")
    for rel_bin_path in abs_bin_pths:

        if rel_bin_path and rel_bin_path not in cur_env_paths:
            # print("\t\t{0}".format(rel_bin_path))
            # print("path: {0}".format(osenv['PATH']))
            osenv['PATH'] += os.pathsep + rel_bin_path

    # print("\n\tInserting bin/dll path to front of $PATH:")

    for bin_pth in MAYA_BIN_PTHS:
        # print("\n\t\t{0}\n\n".format(bin_pth))
        osenv['PATH'] = bin_pth  + os.pathsep +  osenv['PATH']


    #---------------< Append to Python sys.path  >-------------------------------

    #The main Prologue Python dir.
    #   It's relative to this sitecustomize file.
    toks = filter( None, THIS_D_PTH.split('/') ) # Tokenize the cur script path.
    toks.insert( 0, "//" ) # Insert the UNC path string to the list.
    py_pipe_root_pth = ppath.join(*toks[0:5]) # Create the Prologue root Python path.
    sys.path.append(py_pipe_root_pth)



try:
    setup_env()
except Exception:
    # print("The env setup failed to execute.")
    exc_type, exc_value, exc_traceback = sys.exc_info()
    traceback.print_exception(exc_type, exc_value, exc_traceback, file=sys.stdout)


#==========================< END OF FILE >======================================
